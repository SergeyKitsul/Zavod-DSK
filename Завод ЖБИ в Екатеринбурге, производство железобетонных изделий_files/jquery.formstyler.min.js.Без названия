function getRealOffset(e){if(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/Windows Phone/i)){var t=document.body.getBoundingClientRect(),s=e.get(0).getBoundingClientRect();return{left:s.left-t.left,top:s.top-t.top}}return{left:e.offset().left,top:e.offset().top}}function initStyler(){$("select.styler, input.styler").styler()}$.fn.styler=function(e){var t=void 0!==window.formLang&&void 0!==window.formLang.browse?window.formLang.browse:"Обзор",s=void 0!==window.formLang&&void 0!==window.formLang.file_not_select?window.formLang.file_not_select:"Выберите файл",q=$.extend({wrapper:"form",idSuffix:"-styler",filePlaceholder:t,fileBrowse:s,selectSearch:!0,selectSearchLimit:30,selectSearchLimitWithCheckbox:10,selectSearchNotFound:"Совпадений не найдено",selectSearchPlaceholder:"Поиск...",selectVisibleOptions:0,singleSelectzIndex:"1000",selectSmartPositioning:!0,onSelectOpened:function(){},onSelectClosed:function(){},onFormStyled:function(){}},e);return this.each(function(){var e,t,s,C=$(this);function k(){var e="",t="",s="",i="";void 0!==C.attr("id")&&""!==C.attr("id")&&(e=' id="'+C.attr("id")+q.idSuffix+'"'),void 0!==C.attr("title")&&""!==C.attr("title")&&(t=' title="'+C.attr("title")+'"'),void 0!==C.attr("class")&&""!==C.attr("class")&&(s=" "+C.attr("class"));for(var l=$.data(C),o=0;o<l.length;o++)""!==l[o]&&(i+=" data-"+o+'="'+l[o]+'"');e+=i,this.id=e,this.title=t,this.classes=s}C.is(":checkbox")?C.parent("div.jq-checkbox").length<1&&((e=function(){var e=new k,t=$("<div"+e.id+' class="jq-checkbox'+e.classes+'"'+e.title+'><div class="jq-checkbox__div"></div></div>');C.css({position:"absolute",zIndex:"-1",opacity:0,margin:0,padding:0}).after(t).prependTo(t),t.attr("unselectable","on").css({"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","-o-user-select":"none","user-select":"none",display:"inline-block",position:"relative",overflow:"hidden"}),C.is(":checked")&&t.addClass("checked"),C.is(":disabled")&&t.addClass("disabled"),t.bind("click.styler",function(e){return t.is(".disabled")||(C.is(":checked")?(C.attr("checked",!1),t.removeClass("checked")):(C.attr("checked",!0),t.addClass("checked")),C.change()),!1}),C.closest("label").add('label[for="'+C.attr("id")+'"]').click(function(e){return e.preventDefault(),"A"==e.target.tagName&&$(e.target).attr("href")&&void 0!==$(e.target).attr("href")?(window.location.href=$(e.target).attr("href"),!0):void t.click()}),C.bind("change.styler",function(){C.is(":checked")?t.addClass("checked"):t.removeClass("checked")}).bind("keydown.styler",function(e){32==e.which&&t.click()}).bind("focus.styler",function(){t.is(".disabled")||t.addClass("focused")}).bind("blur.styler",function(){t.removeClass("focused")})})(),C.bind("refresh",function(){C.unbind(".styler").parent().before(C).remove(),e()})):C.is(":radio")?C.parent("div.jq-radio").length<1&&((t=function(){var e=new k,t=$("<div"+e.id+' class="jq-radio'+e.classes+'"'+e.title+'><div class="jq-radio__div"></div></div>');C.css({position:"absolute",zIndex:"-1",opacity:0,margin:0,padding:0}).after(t).prependTo(t),t.attr("unselectable","on").css({"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","-o-user-select":"none","user-select":"none",display:"inline-block",position:"relative"}),C.is(":checked")&&t.addClass("checked"),C.is(":disabled")&&t.addClass("disabled"),t.bind("click.styler",function(){return t.is(".disabled")||t.find("input:radio").is(":checked")||(t.closest(q.wrapper).find('input[name="'+C.attr("name")+'"]').attr("checked",!1).parent().removeClass("checked"),C.attr("checked",!0).parent().addClass("checked"),C.change()),!1}),C.closest("label").add('label[for="'+C.attr("id")+'"]').click(function(e){t.click(),e.preventDefault()}),C.bind("change.styler",function(){C.parent().addClass("checked")}).bind("focus.styler",function(){t.is(".disabled")||t.addClass("focused")}).bind("blur.styler",function(){t.removeClass("focused")})})(),C.bind("refresh",function(){C.unbind(".styler").parent().before(C).remove(),t()})):C.is(":file")?C.css({position:"absolute",top:0,right:0,width:"100%",height:"100%",opacity:0,margin:0,padding:0}).each(function(){var e;C.parent("div.jq-file").length<1&&((e=function(){var e=new k,i=$("<div"+e.id+' class="jq-file'+e.classes+'"'+e.title+' style="display: inline-block; position: relative; overflow: hidden"></div>'),l=$('<div class="jq-file__name">'+q.filePlaceholder+"</div>").appendTo(i);$('<div class="jq-file__browse">'+q.fileBrowse+"</div>").appendTo(i);C.after(i),i.append(C),C.is(":disabled")&&i.addClass("disabled"),C.bind("change.styler",function(){var e=C.val();if(C.is("[multiple]")){e="";for(var t=C[0].files,s=0;s<t.length;s++)e+=(0<s?", ":"")+t[s].name}l.text(e.replace(/.+[\\\/]/,"")),""===e?(l.text(q.filePlaceholder),i.removeClass("changed")):i.addClass("changed")}).bind("focus.styler",function(){i.addClass("focused")}).bind("blur.styler",function(){i.removeClass("focused")}).bind("click.styler",function(){i.removeClass("focused")})})(),C.bind("refresh",function(){C.unbind(".styler").parent().before(C).remove(),e()}))}):C.is("select")?C.parent("div.jqselect").length<1&&((s=function(){function m(e){e.unbind("mousewheel DOMMouseScroll").bind("mousewheel DOMMouseScroll",function(e){var t=null;"mousewheel"==e.type?t=-1*e.originalEvent.wheelDelta:"DOMMouseScroll"==e.type&&(t=40*e.originalEvent.detail),t&&(e.stopPropagation(),e.preventDefault(),$(this).scrollTop(t+$(this).scrollTop()))})}var x=$("option",C),w="";function y(){for(var e=0;e<x.length;e++){var t=x.eq(e),s="",i="",l="",o="",n="",d="",c="",a="",r="",h="";t.prop("selected")&&(i="selected sel",h=" checked"),t.is(":disabled")&&(i="disabled"),t.is(":selected:disabled")&&(i="selected sel disabled"),void 0!==t.attr("id")&&""!==t.attr("id")&&(o=' id="'+t.attr("id")+q.idSuffix+'"'),void 0!==t.attr("title")&&""!==x.attr("title")&&(n=' title="'+t.attr("title")+'"'),void 0!==t.attr("class")&&(c=" "+t.attr("class"),r=' data-jqfs-class="'+t.attr("class")+'"');var f,u=t.data();for(f in u)""!==u[f]&&(d+=" data-"+f+'="'+u[f]+'"');i+c!==""&&(l=' class="'+i+c+'"'),s=C.is("[data-custom-multiple]")?"<li"+r+d+l+n+o+">"+('<div class="jq-selectbox__multiple-item"><input type="checkbox" class="styler"'+h+"><span>"+t.html()+"</span></div>")+"</li>":"<li"+r+d+l+n+o+">"+t.html()+"</li>",t.parent().is("optgroup")&&(void 0!==t.parent().attr("class")&&(a=" "+t.parent().attr("class")),s="<li"+r+d+' class="'+i+c+" option"+a+'"'+n+o+">"+t.html()+"</li>",t.is(":first-child")&&(s='<li class="optgroup'+a+'">'+t.parent().attr("label")+"</li>"+s)),w+=s}}function e(e){(e=e||!1)&&(q.selectSearch=!0,q.selectSearchLimit=q.selectSearchLimitWithCheckbox);var t=new k,a=$("<div"+t.id+' class="jq-selectbox jqselect'+t.classes+'" style="display: inline-block; position: relative; z-index:'+q.singleSelectzIndex+'"><div class="jq-selectbox__select"'+t.title+' style="position: relative"><div class="jq-selectbox__select-text"></div><div class="jq-selectbox__trigger"><div class="jq-selectbox__trigger-arrow"></div></div></div></div>');C.css({margin:0,padding:0}).after(a).prependTo(a);var s=$("div.jq-selectbox__select",a),i=$("div.jq-selectbox__select-text",a),l=x.filter(":selected");l.length?i.html(l.text()):i.html(x.filter(":first").text()),y();var o="";q.selectSearch&&(o='<div class="jq-selectbox__search"><input type="search" autocomplete="off" placeholder="'+q.selectSearchPlaceholder+'"></div><div class="jq-selectbox__not-found">'+q.selectSearchNotFound+"</div>");var r=$('<div class="jq-selectbox__dropdown" style="position: absolute">'+o+'<ul style="position: relative; list-style: none; overflow: auto; overflow-x: hidden">'+w+"</ul></div>");$("body").append(r);var h=$("ul",r),f=$("li",r),u=$("input",r),p=$("div.jq-selectbox__not-found",r).hide();f.length<q.selectSearchLimit&&u.parent().hide();var n=0,d=0;f.each(function(){var e=$(this);e.innerWidth()>n&&(n=e.innerWidth(),d=e.width()+20)});t=a.clone().appendTo("body").width("auto"),o=t.width();t.remove(),o==a.width()&&(i.width(d),n+=a.find("div.jq-selectbox__trigger").width()),n>a.width()&&r.width(n),C.css({position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:0});var v=a.outerHeight(),g=u.outerHeight(),b=h.css("max-height"),o=f.filter(".selected");o.length<1&&!e&&f.filter(":first").addClass("selected sel"),void 0===f.data("li-height")&&f.data("li-height",f.outerHeight());r.css("top");function c(){var e=[];$.each(x.filter(":selected"),function(){e.push($(this).text())}),e.length?3<e.length?i.html(e.slice(0,3).join(", ")+", ..."):i.html(e.join(", ")):i.html(C.data("title"))}"auto"==r.css("left")&&r.css({left:0}),"auto"==r.css("top")&&r.css({top:v}),r.hide(),o.length&&(x.filter(":first").text()!=l.text()&&a.addClass("changed"),a.data("jqfs-class",o.data("jqfs-class")),a.addClass(o.data("jqfs-class"))),C.is(":disabled")?a.addClass("disabled"):(s.click(function(){if($("div.jq-selectbox").filter(".opened").length&&q.onSelectClosed.call($("div.jq-selectbox").filter(".opened")),C.focus(),!!!navigator.userAgent.match(/(iPad|iPhone|iPod)/g)){var e=$(window),t=f.data("li-height"),s=a.offset().top,i=e.height()-v-(s-e.scrollTop()),l=q.selectVisibleOptions,o=5*t,n=t*l;0<l&&l<6&&(o=n),0===l&&(n="auto");var d=getRealOffset(a),l=function(){p.hide();function e(){h.css("max-height",Math.floor((i-20-g)/t)*t-t)}e(),$.browser.msie||h.css("max-height",n),"none"!=b&&h.css("max-height",b),i<r.outerHeight()+40&&e(),r.css({width:a.width()+"px",left:d.left+"px",top:d.top+a.height()+"px","z-index":2e3})};return!0===q.selectSmartPositioning?o+g+20<i?l():(p.hide(),c(),$.browser.msie||h.css("max-height",n),"none"!=b&&h.css("max-height",b),s-e.scrollTop()-20<r.outerHeight()+20&&c(),r.css({width:a.width()+"px",left:d.left+"px",top:d.top-r.outerHeight()+"px",bottom:"auto","z-index":2e3,height:"auto"})):!1===q.selectSmartPositioning&&o+g+20<i&&l(),$("div.jqselect").css({zIndex:q.singleSelectzIndex-1}).removeClass("opened"),a.css({zIndex:q.singleSelectzIndex}),r.is(":hidden")?($("div.jq-selectbox__dropdown:visible").hide(),r.show(),a.addClass("opened focused"),q.onSelectOpened.call(a)):(r.hide(),a.removeClass("opened"),$("div.jq-selectbox").filter(".opened").length&&q.onSelectClosed.call(a)),f.filter(".selected").length&&(h.innerHeight()/t%2!=0&&(t/=2),h.scrollTop(h.scrollTop()+f.filter(".selected").position().top-h.innerHeight()/2+t)),u.length&&(u.val("").keyup(),p.hide(),u.keyup(function(){var e=$(this).val();f.each(function(){$(this).html().match(new RegExp(".*?"+e+".*?","i"))?$(this).show():$(this).hide()}),f.filter(":visible").length<1?p.show():p.hide()})),m(h),!1}function c(){h.css("max-height",Math.floor((s-e.scrollTop()-20-g)/t)*t)}}),f.hover(function(){$(this).siblings().removeClass("selected")}),f.filter(".selected").text(),f.filter(".selected").text(),f.filter(":not(.disabled):not(.optgroup)").click(function(){C.focus();var e,t=$(this),s=t.text();t.is(".selected")||(e=f.index(t),e-=t.prevAll(".optgroup").length,t.addClass("selected sel").siblings().removeClass("selected sel"),x.attr("selected",!1).eq(e).attr("selected",!0),i.html(s),a.data("jqfs-class")&&a.removeClass(a.data("jqfs-class")),a.data("jqfs-class",t.data("jqfs-class")),a.addClass(t.data("jqfs-class")),C.change()),u.length&&(u.val("").keyup(),p.hide()),r.hide(),a.removeClass("opened"),q.onSelectClosed.call(a)}),r.mouseout(function(){$("li.sel",r).addClass("selected")}),C.bind("change.styler",function(){i.html(x.filter(":selected").text()),f.removeClass("selected sel").not(".optgroup").eq(C[0].selectedIndex).addClass("selected sel"),x.filter(":first").text()!=f.filter(".selected").text()?a.addClass("changed"):a.removeClass("changed")}).bind("focus.styler",function(){a.addClass("focused"),$("div.jqselect").not(".focused").removeClass("opened")}).bind("blur.styler",function(){a.removeClass("focused")}).bind("keydown.styler keyup.styler",function(e){var t=f.data("li-height");i.html(x.filter(":selected").text()),f.removeClass("selected sel").not(".optgroup").eq(C[0].selectedIndex).addClass("selected sel"),38!=e.which&&37!=e.which&&33!=e.which&&36!=e.which||h.scrollTop(h.scrollTop()+f.filter(".selected").position().top),40!=e.which&&39!=e.which&&34!=e.which&&35!=e.which||h.scrollTop(h.scrollTop()+f.filter(".selected").position().top-h.innerHeight()+t),32==e.which&&e.preventDefault(),13==e.which&&(e.preventDefault(),r.hide(),a.removeClass("opened"),q.onSelectClosed.call(a))}),$(document).bind("click",function(e){$(e.target).parents().hasClass("jq-selectbox__dropdown")||"OPTION"==e.target.nodeName||($("div.jq-selectbox").filter(".opened").length&&q.onSelectClosed.call($("div.jq-selectbox").filter(".opened")),u.length&&u.val("").keyup(),r.hide().find("li.sel").addClass("selected"),a.removeClass("focused opened"))}),e&&(c(),r.unbind("mouseout"),f.unbind("hover"),C.unbind("change.styler"),C.bind("change.styler",function(e){f.removeClass("selected sel"),$.each(x.filter(":selected"),function(){f.not(".optgroup").eq($(this).index()).addClass("selected sel")}),c()}),a.on("keydown keyup",function(){return!1}),C.unbind("keydown.styler keyup.styler"),f.filter(":not(.disabled):not(.optgroup)").unbind("click"),f.filter(":not(.disabled):not(.optgroup)").click(function(e,t){e.stopPropagation(),C.focus();var s=$(this),i=(s.text(),s.find("input:checkbox")),e=f.index(s);e-=s.prevAll(".optgroup").length,void 0===t&&(i.is(":checked")?s.find("input:checkbox").removeAttr("checked"):s.find("input:checkbox").attr("checked",!0)).trigger("refresh"),i.is(":checked")?(x.eq(e).attr("selected",!0),a.data("jqfs-class")&&a.removeClass(a.data("jqfs-class")),a.data("jqfs-class",s.data("jqfs-class")),a.addClass(s.data("jqfs-class"))):x.eq(e).attr("selected",!1),C.change(),u.length&&(u.val("").keyup(),p.hide()),q.onSelectClosed.call(a)}),f.find("input:checkbox").on("change",function(e){e.stopPropagation(),$(this).closest("li").trigger("click",["checkbox"])})))}C.is("[data-custom-multiple]")?e(!0):(C.is("[multiple]")?function(){var e=new k,t=$("<div"+e.id+' class="jq-select-multiple jqselect'+e.classes+'"'+e.title+' style="display: inline-block; position: relative"></div>');C.css({margin:0,padding:0}).after(t),y(),t.append("<ul>"+w+"</ul>");var s=$("ul",t).css({position:"relative","overflow-x":"hidden","-webkit-overflow-scrolling":"touch"}),l=$("li",t).attr("unselectable","on").css({"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","-o-user-select":"none","user-select":"none"}),i=C.attr("size"),e=s.outerHeight(),o=l.outerHeight();l.height()<=0&&(o=25),void 0!==i&&0<i?s.css({height:o*i}):s.css({height:4*o}),e>t.height()&&(s.css("overflowY","scroll"),m(s),l.filter(".selected").length&&s.scrollTop(s.scrollTop()+l.filter(".selected").position().top)),C.prependTo(t).css({position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:0}),C.is(":disabled")?(t.addClass("disabled"),x.each(function(){$(this).is(":selected")&&l.eq($(this).index()).addClass("selected")})):(l.filter(":not(.disabled):not(.optgroup)").click(function(e){C.focus();var t,s,i=$(this);e.ctrlKey||e.metaKey||i.addClass("selected"),e.shiftKey||i.addClass("first"),e.ctrlKey||e.metaKey||e.shiftKey||i.siblings().removeClass("selected first"),(e.ctrlKey||e.metaKey)&&(i.is(".selected")?i.removeClass("selected first"):i.addClass("selected first"),i.siblings().removeClass("first")),e.shiftKey&&(s=t=!1,i.siblings().removeClass("selected").siblings(".first").addClass("selected"),i.prevAll().each(function(){$(this).is(".first")&&(t=!0)}),i.nextAll().each(function(){$(this).is(".first")&&(s=!0)}),t&&i.prevAll().each(function(){return!$(this).is(".selected")&&void $(this).not(".disabled, .optgroup").addClass("selected")}),s&&i.nextAll().each(function(){return!$(this).is(".selected")&&void $(this).not(".disabled, .optgroup").addClass("selected")}),1==l.filter(".selected").length&&i.addClass("first")),x.attr("selected",!1),l.filter(".selected").each(function(){var e=$(this),t=l.index(e);e.is(".option")&&(t-=e.prevAll(".optgroup").length),x.eq(t).attr("selected",!0)}),C.change()}),x.each(function(e){$(this).data("optionIndex",e)}),C.bind("change.styler",function(){l.removeClass("selected");var t=[];x.filter(":selected").each(function(){t.push($(this).data("optionIndex"))}),l.not(".optgroup").filter(function(e){return-1<$.inArray(e,t)}).addClass("selected")}).bind("focus.styler",function(){t.addClass("focused")}).bind("blur.styler",function(){t.removeClass("focused")}),e>t.height()&&C.bind("keydown.styler",function(e){0!=l.filter(".selected:last").length&&(38!=e.which&&37!=e.which&&33!=e.which||s.scrollTop(s.scrollTop()+l.filter(".selected").position().top-o),40!=e.which&&39!=e.which&&34!=e.which||s.scrollTop(s.scrollTop()+l.filter(".selected:last").position().top-s.innerHeight()+2*o))}))}:e)()})(),C.bind("refresh",function(){C.unbind(".styler").parent().before(C).remove(),s()})):C.is(":reset")&&C.bind("click",function(){setTimeout(function(){C.closest(q.wrapper).find("input, select").trigger("refresh")},1)}),$(window).resize(function(){$("div.jq-selectbox").filter(".opened").length&&q.onSelectClosed.call($("div.jq-selectbox").filter(".opened")),$(".jq-selectbox__search input").length&&$(".jq-selectbox__search input").val().length&&$(".jq-selectbox__search input").val("").keyup(),$(".jq-selectbox__dropdown").hide().find("li.sel").addClass("selected"),$(".jq-selectbox").removeClass("focused opened")})})},$(function(){initStyler()});